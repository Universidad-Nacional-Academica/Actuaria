---
title: |
  | \includegraphics[height=2.5in]{figuras/logo.png}
  | \Huge\bf {Parcial 1}
  | \vspace{1cm}
subtitle: |
  | \LARGE Distribuciones de Supervivencia & Tablas de vida
  | \vspace{4cm}
author: |
  |  Por:
  |  \vspace{3cm}
  |  \Large Jefferson Gamboa Betancur
  |  \Large Luis Felipe Bedoya Martínez
date: |
  | Facultad de Ciencias
  | Medellín
  | 2021
output:
   pdf_document:
       includes:
        in_header: mystyle.tex
editor_options: 
  markdown: 
    wrap: 92
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, 
                      warning = FALSE, comment = '', 
                      fig.show = "asis", fig.align = "center", cache = TRUE)
```

\thispagestyle{empty}

\newpage

\setcounter{page}{1}

# Problema 1

Considere la fuerza de mortalidad estándar $\mu_{x+t}$ según el modelo asignado. Utilice los
parámetros que aparecen en los ejemplos de las Notas de Clase, vea las secciones
\textsection 2.5 y \textsection 2.6.

Asuma una fuerza de mortalidad sub-estándar según el modelo multiplicativo en (2.27), para
una vida (x), dada por

$$\mu_{x+t}^s=\theta\mu_{x+t}$$

con $\theta > 1$ dada. Denote por $T(x^s)$ su vida media residual. Asuma $x_1=30$, $t=20$,
$\theta=1.2$.

```{=tex}
\benum
  \item
```
Defina la probabilidad de fallecer dos vidas $x1$, $x2$ antes de $t$ años como

$$_{t}q_{\overline{x_1x_2}}:={_{t}q_{x_1}} \cdotp {_{t}q_{x_2}}$$ Encuentre
$_{t}q_{\overline{x_1,x_1^s}}$. Observe que
$_{t}q_{\overline{x_1x_2}} \neq 1-{_{t}p_{x_1x_2}}$.

\item

Encuentre $\mathbb{E}(T(x_1^s))= \textup{\r{e}} x_1^s$. Encuentre
$1-\frac{\textup{\r{e}} x_1^s}{e_{x_1}}$, el porcentaje se reduce la esperanza de vida de
$(x_1^s)$ con respecto a otra vida $(x_1)$ con la fuerza de mortalidad $\mu_{x+t}$

\item

Encuentre $P(T(x_1)<T(x_1^s))$.

\item

Genere una Tabla de Vida con los valores de $\mu_x$. Encuentre la probabilidad de (30)
fallecer antes de cumplir 50 con esta Tabla. \eenum


```{r}
muxt.gm <- function(t,x,pars){
  a <- pars[1]
  b <- pars[2]
  C <- pars[3]
  mx <- a + b*C^(x+t)
  return(mx)
}
tpx.gm <- function(t,x,pars){
  a <-  pars[1]
  b <- pars[2]
  C <- pars[3]
  p <- exp(-a*t - b*C^x*(C^t-1)/log(C))
  return(p)
}
#--- parámetros GM
a <-  0.0005
b <- 10^(-4.12)
C <- 10^(0.038)
pars <- c(a,b,C)
#--- parámetros del problema
x1 <- 30
t <- 20
theta <- 1.2
w <- 110
```

\newpage

\section{Solución}

\subsection{(a)}

Con la información en el enunciado se tiene que:
```{=tex}
\begin{align*}
  \prescript{}{t}{q}_{\overline{x_1 x_2}} =\prescript{}{t}{q}_{x_1} \cdot \prescript{}{t}{q}_{x_2} &= \left(1 - \prescript{}{t}{p}_{x_1}\right)\left(1 - \prescript{}{t}{p}_{x_2}\right)\\
  &= 1 - \prescript{}{t}{p}_{x_1} - \prescript{}{t}{p}_{x_2} + \prescript{}{t}{p}_{x_1}\prescript{}{t}{p}_{x_2} \\
  \therefore \prescript{}{t}{q}_{\overline{x_1 x_2}} &= 1 - \prescript{}{t}{p}_{\overline{x_1x_2}} \\
                                                    & \text{Donde} \\ 
\prescript{}{t}{p}_{\overline{x_1x_2}} &= \prescript{}{t}{p}_{x_1} + \prescript{}{t}{p}_{x_2} - \prescript{}{t}{p}_{x_1}\prescript{}{t}{p}_{x_2}
\end{align*}
```

Por lo tanto:
```{=tex}
\begin{align*}
\prescript{}{t}{q}_{\overline{x_1 x_1^s}} &= \prescript{}{t}{q}_{x_1} \cdot \prescript{}{t}{q}_{x_1^s}\\
                                          &= 1 - \prescript{}{t}{p}_{x_1} - \prescript{}{t}{p}_{x_1^s} + \prescript{}{t}{p}_{x_1}\prescript{}{t}{p}_{x_1^s} \\
                                          & \text{Por el modelo multiplicativo:} \\
                                          &= 1 - \prescript{}{t}{p}_{x_1} - \prescript{}{t}{p^\theta}_{x_1} + \prescript{}{t}{p}_{x_1}\prescript{}{t}{p^\theta}_{x_1} \\
                                          & \text{Finalmente se tiene que:} \\
\prescript{}{t}{q}_{\overline{x_1 x_1^s}} &= \left(1- \prescript{}{t}{p}_{x_1}\right) (1 - \prescript{}{t}{p^\theta}_{x_1}) & 
\end{align*}
```

```{r}
pt.x1 = tpx.gm(t,x1,pars)
pt.x1
```
```{r}
(1-pt.x1)*(1-(pt.x1)^theta)
```

\newpage

\subsection{(b)}

Se conoce que:
```{=tex}
\begin{align*}
\mathbb{E}[T(x_1^s)] &= \textup{\r{e}} x_1^s \\
                      & \text{Ahora, por definición:} \\
\mathbb{E}[T(x_1^s)] &= \int_0^\infty P(T(x_1^s)>t)dt \\
                     &= \int_0^\infty \prescript{}{t}{p}_{x_1^s}dt \\
                     & \text{Por el modelo multiplicativo:} \\
                     &= \int_0^\infty \prescript{}{t}{p^\theta}_{x_1}dt \\
                     &= \int_0^{\omega-x_1} \left( e^{-at-\frac{bc^{x_{1}}}{ln(c)}(c^t-1)} \right)^\theta dt
\end{align*}
```

```{r}
#------uso de integracion numerica con R
f <- function(t) tpx.gm(t,x1,pars)^theta
integrate(f,lower=0,upper=w-x1)$value
```

\newpage

\subsection{(c)}

Aplicando el teorema de probabilidad total se tiene que:
```{=tex}
\begin{align*}
\mathbb{P}(T(x_1) < T(x_1^s)) &= \int_0^{\omega-x} P(T(x_1) < T(x_1^s) \arrowvert T(x_1) = t) \prescript{}{t}{p}_{x_1}\mu_{x_1 + t}dt\\
                              &= \int_0^{\omega-x} P(t< T(x_1^s)) \prescript{}{t}{p}_{x_1}\mu_{x_1 + t} dt\\
                              &= \int_0^{\omega-x} \prescript{}{t}{p}_{x_1^s}\prescript{}{t}{p}_{x_1} \mu_{x_1+t} dt \\
                              & \text{Por el modelo multiplicativo:} \\
                              &= \int_0^{\omega-x} \prescript{}{t}{p^\theta}_{x_1}\prescript{}{t}{p}_{x_1} \mu_{x_1+t} dt\\
                              &= \int_0^{\omega-x} \prescript{}{t}{p^{\theta+1}}_{x_1} \mu_{x_1+t} dt\\
                              &= \int_0^{\omega-x_1} \left( e^{-at-\frac{bc^{x_{1}}}{ln(c)}(c^t-1)} \right)^{\theta+1} \left( a+bc^{x_{1}+t} \right) dt
\end{align*}
```

```{r}
#------uso de integracion numerica con R
f <- function(t) (tpx.gm(t,x1,pars)^(theta+1)) * muxt.gm(t,x1,pars)
integrate(f,lower=0,upper=w-x1)$value
```

\newpage

\subsection{(d)}

```{r}
#---------generar tablas de vida con base
# en la fuerza de mortalidad estimada
require(lifecontingencies)
x = seq(0,109)
probs = tpx.gm(1,x,pars)
D = probs2lifetable(probs, radix = 100000, type = "px", name = "TablaVidaGM")
head(D)
tail(D)
TVH <- new("lifetable", x=D@x, lx=D@lx, name="tablas.GM")
```


```{r}
#------probabilidad de fallecer
qxt(TVH,x=x1,t=t)
```

La probabilidad de que (30) fallezca antes de cumplir 50 es de 6.47% aproximadamente.